## STUFF

kubectl debug -it ubuntu --image=dockersec/tcpdump --target ubuntu -- sh

sudo ufw disable

## Deploy

k create namespace afn
k create namespace cert-manager
mkdir -p secret/
export LINODE_TOKEN=XYZ
cat > secret/linode-token.yaml << EOF
---
apiVersion: v1
kind: Secret
metadata:
  name: linode-api-token
  namespace: afn
stringData:
  linode_api_token: $LINODE_TOKEN
---
apiVersion: v1
kind: Secret
metadata:
  namespace: cert-manager
  name: linode-credentials
stringData:
  token: $LINODE_TOKEN
EOF
k apply -f secret/linode-token.yaml

# helm upgrade external-dns oci://registry-1.docker.io/bitnamicharts/external-dns --install --values external-dns-values.yaml --namespace=afn

helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install \
  cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --version v1.13.1 \
  --set installCRDs=true

helm install cert-manager-webhook-linode \
  --namespace cert-manager \
  https://github.com/slicen/cert-manager-webhook-linode/releases/download/v0.2.0/cert-manager-webhook-linode-v0.2.0.tgz
# helm upgrade cert-manager-webhook-linode   --namespace cert-manager --set deployment.logLevel=null   https://github.com/slicen/cert-manager-webhook-linode/releases/download/v0.2.0/cert-manager-webhook-linode-v0.2.0.tgz --install

helm upgrade afn charts/afn/ --install --namespace=afn --values afn-values.yaml

